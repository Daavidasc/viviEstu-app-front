<div class="app-container">
  <app-landlord-navbar />

  <main class="main-content">
    <div class="container">
      @if (isLoading) {
      <app-loading-spinner message="Cargando panel de control..." />
      } @else {
      <div class="dashboard-header">
        <h1 class="greeting">Hola {{ userName }}</h1>
        <div class="header-actions">
          <h2 class="section-title-gold">Flujo de Alquileres</h2>
          <a routerLink="/landlord/upload" class="btn btn-primary btn-upload" style="text-decoration: none;">Subir
            Alojamiento</a>
        </div>
      </div>

      <!-- Analytics Table Section -->
      <section class="analytics-section">
        @if (analyticsError) {
        <div class="alert alert-info">
          <h4>Estadísticas de Interacciones</h4>
          <p>{{ analyticsError }}</p>
          <small>Las estadísticas aparecerán cuando los estudiantes interactúen con tus alojamientos.</small>
        </div>
        } @else if (analytics.length > 0) {
        <div class="analytics-table-container">
          <table class="analytics-table">
            <thead>
              <tr>
                <th>Alojamiento</th>
                <th>Interacciones</th>
                <th>Estudiantes</th>
                <th>Universidad Principal</th>
                <th>Distrito Principal</th>
                <th>Promedio/Estudiante</th>
                <th>Última Interacción</th>
              </tr>
            </thead>
            <tbody>
              @for(item of analytics; track item.id) {
              <tr>
                <td class="accommodation-name">{{ item.name }}</td>
                <td class="metric-value">{{ item.totalInteractions }}</td>
                <td class="metric-value">{{ item.uniqueStudents }}</td>
                <td class="university">{{ item.topUniversity }}</td>
                <td class="district">{{ item.topDistrict }}</td>
                <td class="metric-value">{{ item.avgInteractionsPerStudent | number:'1.1-1' }}</td>
                <td class="last-interaction">{{ item.formattedLastInteraction }}</td>
              </tr>
              }
            </tbody>
          </table>
        </div>
        } @else {
        <div class="no-analytics">
          <p>No hay datos de interacciones disponibles.</p>
        </div>
        }
      </section>

      <section class="my-rentals-section">
        <h3 class="section-subtitle-orange">Mis Alquileres</h3>
        <div class="rentals-list">
          @for(rental of myRentals; track rental.id) {
          <app-landlord-rental-card [rental]="rental" />
          }
        </div>
      </section>
      }
    </div>
  </main>

  <app-footer />
</div>
