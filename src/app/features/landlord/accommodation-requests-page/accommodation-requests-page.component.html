<div class="app-container">
  <app-landlord-navbar />

  <!-- Notification Popup -->
  @if (notification.show) {
  <div class="notification-toast" [class]="'notification-' + notification.type">
    <div class="notification-content">
      <div class="notification-message">{{ notification.message }}</div>
      <button class="notification-close" (click)="closeNotification()">
        Entendido
      </button>
    </div>
  </div>
  }

  <main class="main-content">
    <div class="container">
      <!-- Header -->
      <div class="page-header">
        <h1 class="page-title">Solicitudes de Alojamientos</h1>
        <div class="header-stats">
          <span class="total-requests">{{ getTotalRequests() }} solicitudes totales</span>
        </div>
      </div>

      <!-- Loading state -->
      @if (isLoading) {
      <div class="loading-container">
        <p>Cargando solicitudes...</p>
      </div>
      }

      <!-- Accommodations with requests -->
      @if (!isLoading) {
      <div class="accommodations-list">
        @for (accommodation of accommodationsWithRequests; track accommodation.id) {
        <div class="accommodation-card">
          <!-- Accommodation header -->
          <div class="accommodation-header">
            <div class="accommodation-info">
              <img [src]="accommodation.imageUrl" [alt]="accommodation.title" class="accommodation-image">
              <div class="accommodation-details">
                <h2 class="accommodation-title">
                  <a [routerLink]="['/landlord/accommodations', accommodation.id]" class="title-link">
                    {{ accommodation.title }}
                  </a>
                </h2>
                <p class="accommodation-address">{{ accommodation.address }}</p>
                <div class="accommodation-meta">
                  <span class="district">{{ accommodation.district }}</span>
                  <span class="price">S/.{{ accommodation.price }}/mes</span>
                </div>
              </div>
            </div>
            <div class="requests-count">
              <span class="count-badge">{{ accommodation.requests.length }}</span>
              <span class="count-label">solicitud{{ accommodation.requests.length !== 1 ? 'es' : '' }}</span>
            </div>
          </div>

          <!-- Requests list -->
          <div class="requests-section">
            @if (accommodation.requests.length === 0) {
            <div class="no-requests">
              <p>No hay solicitudes para este alojamiento</p>
            </div>
            } @else {
            <div class="requests-list">
              @for (request of accommodation.requests; track request.requestId) {
              <div class="request-item">
                <div class="request-header">
                  <div class="student-info">
                    <div class="student-details">
                      <h4 class="student-name">{{ request.title }}</h4>
                      <span class="student-university">{{ request.subtitle }}</span>
                    </div>
                  </div>
                  <div class="request-meta">
                    <span class="request-status" [class]="getStatusClass(request.status)">
                      {{ request.status }}
                    </span>
                    <span class="request-date">{{ request.date | date:'dd/MM/yyyy' }}</span>
                  </div>
                </div>

                @if (request.message) {
                <div class="request-message">
                  <p>{{ request.message }}</p>
                </div>
                }

                <div class="request-actions">
                  @if (request.status !== 'AGENDADO' && request.status !== 'RECHAZADO') {
                  <button class="btn-action btn-accept" (click)="acceptRequest(request.requestId)">
                    Aceptar
                  </button>
                  <button class="btn-action btn-reject" (click)="rejectRequest(request.requestId)">
                    Rechazar
                  </button>
                  }
                </div>
              </div>
              }
            </div>
            }
          </div>
        </div>
        }

        @if (accommodationsWithRequests.length === 0) {
        <div class="empty-state">
          <h3>No hay solicitudes</h3>
          <p>Cuando recibas solicitudes para tus alojamientos, aparecerán aquí.</p>
        </div>
        }
      </div>
      }
    </div>
  </main>

  <app-footer />
</div>