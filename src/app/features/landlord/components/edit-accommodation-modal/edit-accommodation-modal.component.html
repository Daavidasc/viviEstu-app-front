<div class="modal-overlay" (click)="close.emit()">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Editar Alojamiento</h2>
            <button class="close-btn" (click)="close.emit()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="modal-body">
            <form [formGroup]="accommodationForm" (ngSubmit)="onSubmit()">

                <!-- Basic Info -->
                <div class="form-section">
                    <h3>Información Básica</h3>

                    <div class="form-group">
                        <label>Título</label>
                        <input type="text" formControlName="titulo" class="form-input"
                            [class.error]="hasError('titulo', 'required')">
                        @if(hasError('titulo', 'required')) { <span class="error-msg">Requerido</span> }
                    </div>

                    <div class="form-group">
                        <label>Descripción</label>
                        <textarea formControlName="descripcion" rows="4" class="form-input"
                            [class.error]="hasError('descripcion', 'required')"></textarea>
                        @if(hasError('descripcion', 'required')) { <span class="error-msg">Requerido</span> }
                    </div>

                    <div class="form-group">
                        <label>Dirección</label>
                        <input type="text" formControlName="direccion" class="form-input">
                    </div>

                    <div class="form-group">
                        <label>Nro Partida</label>
                        <input type="text" formControlName="nroPartida" class="form-input">
                    </div>
                </div>

                <!-- Price & Location -->
                <div class="form-section">
                    <h3>Precio y Ubicación</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Precio Mensual (S/.)</label>
                            <input type="number" formControlName="precioMensual" class="form-input">
                        </div>

                        <div class="form-group">
                            <label>Distrito</label>
                            <select formControlName="distritoId" class="form-input">
                                <option [ngValue]="null">Seleccionar</option>
                                @for(d of districts(); track d.id) {
                                <option [value]="d.id">{{d.nombre}}</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Features -->
                <div class="form-section">
                    <h3>Características</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Habitaciones</label>
                            <input type="number" formControlName="habitaciones" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Baños</label>
                            <input type="number" formControlName="banios" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>Área (m²)</label>
                            <input type="number" formControlName="area" class="form-input">
                        </div>
                    </div>
                </div>

                <!-- Universities -->
                <div class="form-section">
                    <h3>Universidades Cercanas</h3>
                    <div class="checkbox-grid">
                        @for(u of universities(); track u.id) {
                        <label class="checkbox-label" [class.selected]="isUniversitySelected(u.id)">
                            <input type="checkbox" [checked]="isUniversitySelected(u.id)"
                                (change)="toggleUniversity(u.id)">
                            {{u.nombre}}
                        </label>
                        }
                    </div>
                </div>

                <!-- Transport -->
                <div class="form-section">
                    <h3>Transporte</h3>
                    <div class="checkbox-grid">
                        @for(t of transportOptions; track t) {
                        <label class="checkbox-label" [class.selected]="isTransportSelected(t)">
                            <input type="checkbox" [checked]="isTransportSelected(t)" (change)="toggleTransport(t)">
                            {{t}}
                        </label>
                        }
                    </div>
                </div>

                <!-- Images -->
                <div class="form-section">
                    <h3>Imágenes</h3>
                    <div class="image-upload">
                        <input type="file" (change)="onFileSelected($event)" multiple accept="image/*"
                            [disabled]="selectedFiles().length >= 10">
                        <div class="preview-grid">
                            @for(url of imageUrls(); track url; let i = $index) {
                            <div class="preview-item">
                                <img [src]="url">
                                <button type="button" (click)="removeImage(i)">&times;</button>
                            </div>
                            }
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-cancel" (click)="close.emit()">Cancelar</button>
                    <button type="submit" class="btn-save" [disabled]="submitting()">
                        {{ submitting() ? 'Guardando...' : 'Guardar Cambios' }}
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>