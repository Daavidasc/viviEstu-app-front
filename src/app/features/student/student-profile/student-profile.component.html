<div class="app-container">
  <app-student-navbar />

  <main class="main-content">
    <div class="container">

      <h1 class="page-title">Mi Perfil</h1>

      <!-- HEADER PERFIL -->
      @if (isLoadingProfile) {
        <app-loading-spinner message="Cargando perfil..." />
      }
      <!-- üëá CORRECCI√ìN: Verificamos que 'student' exista antes de mostrar datos -->
      @else if (student) {
        <div class="profile-header-card">
          <div class="profile-avatar">
            <i class="far fa-user-circle"></i>
          </div>
          <div class="profile-basic-info">
            <!-- Ahora es seguro acceder a .nombre porque verificamos que student no es null -->
            <h2 class="profile-name">{{ student.nombre }} {{ student.apellidos }}</h2>
            <p class="profile-email">{{ student.correo }}</p>
          </div>
        </div>

        <!-- INFORMACI√ìN DETALLADA -->
        <app-profile-info-card [student]="student" />
      }
      <!-- üëá OPCIONAL: Manejo de caso de error donde no carg√≥ y no es loading -->
      @else {
        <div class="error-state">
          <p>No se pudo cargar la informaci√≥n del perfil.</p>
          <button class="btn btn-secondary" (click)="ngOnInit()">Reintentar</button>
        </div>
      }

      <div class="section-spacer"></div>
      <h2 class="section-subtitle">Favoritos</h2>

      @if (isLoadingFavorites) {
        <app-loading-spinner message="Cargando favoritos..." />
      } @else {
        <div class="favorites-list">
          <app-accommodation-card *ngFor="let fav of favorites" [accommodation]="fav"
            (favoriteToggled)="handleFavoriteToggle(fav)" />
          @if (favorites.length === 0) {
            <p>No tienes favoritos a√∫n.</p>
          }
        </div>
      }


      <!-- SECCI√ìN SOLICITUDES ACTIVAS -->
      <div class="section-spacer"></div>
      <h2 class="section-subtitle">Solicitudes Activas</h2>

      @if (isLoadingRequests) {
        <app-loading-spinner message="Cargando solicitudes..." />
      } @else {
        <div class="requests-list">
          <app-request-card *ngFor="let req of requests"
            [request]="req"
            (requestCancelled)="handleCancelRequest($event)" />

          @if (requests.length === 0) {
            <p>No tienes solicitudes activas.</p>
          }
        </div>
      }

    </div>
  </main>

  <app-footer />
</div>
