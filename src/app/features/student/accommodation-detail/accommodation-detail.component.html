<div class="app-container">
  <app-student-navbar />

  @if (isLoading) {
  <main class="main-content">
    <div class="container">
      <app-loading-spinner message="Cargando detalles del alojamiento..."></app-loading-spinner>
    </div>
  </main>
  } @else if (errorMessage) {
  <main class="main-content">
    <div class="container">
      <div class="error-message">
        <p>{{ errorMessage }}</p>
      </div>
    </div>
  </main>
  } @else if (accommodation) {
  <main class="main-content">
    <div class="container content-grid">

      <!--COLUMNA IZQUIERDA: Detalles del Alojamiento -->
      <div class="details-column">
        <div class="card main-card">
          <app-gallery [images]="getImageUrls()" />

          <div class="info-content">
            <!-- Cabecera: Precio y Favorito -->
            <div class="header-row">
              <h1 class="price-tag">S/.{{ accommodation.precioMensual }} <span class="period">/mes</span></h1>
              <button class="btn-favorite" (click)="toggleFavorite()">
                <i class="fa-heart" [class.fas]="accommodation.isFavorite" [class.far]="!accommodation.isFavorite"></i>
              </button>
            </div>

            <p class="description-text">{{ accommodation.descripcion }}</p>

            <!-- CaracterÃ­sticas -->
            <div class="section-block">
              <h3 class="section-label">Incluye:</h3>
              <div class="features-list">
                <span class="feature-tag">{{ accommodation.area }}mÂ²</span>
                <span class="feature-tag">{{ accommodation.banios }} baÃ±o{{ accommodation.banios !== 1 ? 's' : ''
                  }}</span>
                <span class="feature-tag">{{ accommodation.habitaciones }} dorm.</span>
              </div>
            </div>

            <!-- UbicaciÃ³n -->
            <div class="section-block">
              <h3 class="section-label">UbicaciÃ³n:</h3>
              <p class="info-text">{{ accommodation.direccion }}</p>
              <p class="info-text highlight">{{ accommodation.distrito }}</p>
            </div>

            <!-- Universidades Cercanas -->
            <div class="section-block">
              <h3 class="section-label">Universidades Cercanas:</h3>
              <div class="tags-row">
                @for (uni of accommodation.universidades; track uni) {
                <span class="uni-tag">{{ uni }}</span>
                }
              </div>
            </div>

            <!-- Opciones de Movilidad -->
            <div class="section-block">
              <h3 class="section-label">Opciones de movilidad</h3>
              <div class="tags-row">
                @for (mob of accommodation.transportes; track mob) {
                <span class="mobility-tag">{{ mob }}</span>
                }
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- COLUMNA DERECHA: Formulario de Contacto + Comentarios -->
      <div class="sidebar-column">
        <app-contact-form [accommodationId]="accommodation.id" />

        <!-- SecciÃ³n de Comentarios -->
        <div class="comments-card">
          <h3 class="comments-title">ðŸ’¬ Comentarios</h3>

          <!-- Lista de comentarios existentes (scrolleable) -->
          <div class="comments-scroll-container">
            @if (comments.length > 0) {
            <div class="comments-list">
              @for (comment of comments; track comment.id) {
              <div class="comment-item">
                <div class="comment-header">
                  <i class="fas fa-user-circle"></i>
                  <span class="comment-author">{{ comment.estudianteNombre }}</span>
                </div>
                <p class="comment-content">{{ comment.contenido }}</p>
              </div>
              }
            </div>
            } @else {
            <p class="no-comments">
              <i class="fas fa-comments"></i>
              No hay comentarios aÃºn. Â¡SÃ© el primero en comentar!
            </p>
            }
          </div>

          <!-- Formulario para nuevo comentario -->
          <div class="new-comment-form">
            <textarea class="comment-input" rows="3" placeholder="Escribe tu comentario aquÃ­..."
              [(ngModel)]="newComment"></textarea>
            <button class="btn btn-primary btn-comment" (click)="postComment()"
              [disabled]="isPostingComment || !newComment.trim()">
              @if (isPostingComment) {
              <span><i class="fas fa-spinner fa-spin"></i> Enviando...</span>
              } @else {
              <span><i class="fas fa-paper-plane"></i> Comentar</span>
              }
            </button>
          </div>
        </div>
      </div>

    </div>
  </main>
  }

  <app-footer />
</div>